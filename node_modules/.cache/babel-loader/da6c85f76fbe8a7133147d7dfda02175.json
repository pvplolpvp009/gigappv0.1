{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/pvplo/OneDrive/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/editpallav-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/pvplo/OneDrive/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/editpallav-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\pvplo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\editpallav-main\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import signIn from\"../firebase/auth/signin\";import FormControls from\"./FormControl\";import{AiOutlineLoading3Quarters}from\"react-icons/ai\";import{IoCheckmarkCircle,IoWarningOutline}from\"react-icons/io5\";import Spinner from\"./Spinner\";import{getFirestore,doc,getDoc}from\"firebase/firestore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LoginComp=function LoginComp(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),successMessage=_useState8[0],setSuccessMessage=_useState8[1];// Success message state\nvar navigate=useNavigate();var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),errorCode=_useState10[0],setErrorCode=_useState10[1];var handleForm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _yield$signIn,result,error,db,userRef,userDoc,userData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!email||!password)){_context.next=4;break;}setErrorCode(\"Please enter both email and password.\");return _context.abrupt(\"return\");case 4:setLoading(true);_context.next=7;return signIn(email,password);case 7:_yield$signIn=_context.sent;result=_yield$signIn.result;error=_yield$signIn.error;if(!error){_context.next=14;break;}setLoading(false);setErrorCode(\"Incorrect login details!\");return _context.abrupt(\"return\",console.log(error));case 14:// Check user role immediately after successful sign-in\ndb=getFirestore();userRef=doc(db,\"users\",result.user.uid);_context.next=18;return getDoc(userRef);case 18:userDoc=_context.sent;if(userDoc.exists()){userData=userDoc.data();if(userData.role===\"admin\"){setErrorCode(\"\");setSuccessMessage(\"Login successful! Redirecting to dashboard...\");setTimeout(function(){navigate(\"/dashboardAdx/stats\");},2000);// Redirect after 2 seconds\n}else{setLoading(false);setErrorCode(\"Access denied: Admins only.\");}}else{setLoading(false);setErrorCode(\"User data not found.\");}case 20:case\"end\":return _context.stop();}}},_callee);}));return function handleForm(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[successMessage?/*#__PURE__*/_jsx(Spinner,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"form-wrapper flex flex-col items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full text-center pb-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-[24px] sm:text-[28px] font-medium pb-1\",children:\"Welcome Back\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[#b0b0b0] text-[14px] sm:text-[13px] font-light\",children:\"Enter your email and password to login\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col items-center space-y-3 sm:space-y-4\",children:[/*#__PURE__*/_jsx(FormControls,{label:\"Email\",type:\"email\",id:\"email\",placeholder:\"Your email\",value:email,setValue:setEmail}),/*#__PURE__*/_jsx(FormControls,{label:\"Password\",type:\"password\",id:\"password\",placeholder:\"**********\",value:password,setValue:setPassword}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center w-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center space-y-6 sm:space-y-4 w-full sm:w-[47%]\",children:/*#__PURE__*/_jsx(\"button\",{className:\"bg-[#ffffff] uppercase hover:bg-[#c2fa7c] w-full ease-in duration-300 text-[#000] text-[15px] justify-center text-center font-medium h-[50px] border-none outline-none rounded-[12px] flex items-center px-6\",onClick:handleForm,type:\"submit\",disabled:loading,children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[\"Logging in\",/*#__PURE__*/_jsx(AiOutlineLoading3Quarters,{size:18,className:\"animate-spin ml-[12px]\"})]}):\"Login\"})})})]})]}),errorCode&&/*#__PURE__*/_jsx(\"div\",{className:\"z-[60] ease-in duration-300 w-full fixed left-0 right-0 px-4 top-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full text-[#ff4d4d] flex items-center space-x-2 px-4 bg-[#121620ef] h-[50px] rounded-[8px]\",children:[/*#__PURE__*/_jsx(IoWarningOutline,{size:16}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[15px]\",children:errorCode})]})}),successMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"z-[60] ease-in duration-300 w-full fixed left-0 right-0 px-4 top-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full text-[#4dff4d] flex items-center space-x-2 px-4 bg-[#121620ef] h-[50px] rounded-[8px]\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:16}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[15px]\",children:successMessage})]})})]});};export default LoginComp;","map":{"version":3,"names":["React","useState","useNavigate","signIn","FormControls","AiOutlineLoading3Quarters","IoCheckmarkCircle","IoWarningOutline","Spinner","getFirestore","doc","getDoc","LoginComp","email","setEmail","password","setPassword","loading","setLoading","successMessage","setSuccessMessage","navigate","errorCode","setErrorCode","handleForm","event","preventDefault","result","error","console","log","db","userRef","user","uid","userDoc","exists","userData","data","role","setTimeout"],"sources":["C:/Users/pvplo/OneDrive/Рабочий стол/editpallav-main/src/Components/LoginComp.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport signIn from \"../firebase/auth/signin\";\nimport FormControls from \"./FormControl\";\nimport { AiOutlineLoading3Quarters } from \"react-icons/ai\";\nimport { IoCheckmarkCircle, IoWarningOutline } from \"react-icons/io5\";\nimport Spinner from \"./Spinner\";\nimport { getFirestore, doc, getDoc } from \"firebase/firestore\";\n\nconst LoginComp = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState(\"\"); // Success message state\n  const navigate = useNavigate();\n  const [errorCode, setErrorCode] = useState(\"\");\n\n\n  const handleForm = async (event) => {\n    event.preventDefault();\n\n    if (!email || !password) {\n      setErrorCode(\"Please enter both email and password.\");\n      return;\n    }\n\n    setLoading(true);\n\n    const { result, error } = await signIn(email, password);\n\n    if (error) {\n      setLoading(false);\n      setErrorCode(\"Incorrect login details!\");\n      return console.log(error);\n    }\n\n    // Check user role immediately after successful sign-in\n    const db = getFirestore();\n    const userRef = doc(db, \"users\", result.user.uid);\n    const userDoc = await getDoc(userRef);\n\n    if (userDoc.exists()) {\n      const userData = userDoc.data();\n      if (userData.role === \"admin\") {\n        setErrorCode(\"\");\n        setSuccessMessage(\"Login successful! Redirecting to dashboard...\");\n        setTimeout(() => {\n          navigate(\"/dashboardAdx/stats\");\n        }, 2000); // Redirect after 2 seconds\n      } else {\n        setLoading(false);\n        setErrorCode(\"Access denied: Admins only.\");\n      }\n    } else {\n      setLoading(false);\n      setErrorCode(\"User data not found.\");\n    }\n  };\n\n\n  return (\n    <>\n    {successMessage ? \n        (\n            <Spinner/>\n        ) : (\n            <div className=\"form-wrapper flex flex-col items-start\">\n            <div className=\"w-full text-center pb-4\">\n              <h1 className=\"text-[24px] sm:text-[28px] font-medium pb-1\">\n                Welcome Back\n              </h1>\n              <p className=\"text-[#b0b0b0] text-[14px] sm:text-[13px] font-light\">\n                Enter your email and password to login\n              </p>\n            </div>\n            <div className=\"w-full flex flex-col items-center space-y-3 sm:space-y-4\">\n              <FormControls\n                label=\"Email\"\n                type=\"email\"\n                id=\"email\"\n                placeholder=\"Your email\"\n                value={email}\n                setValue={setEmail}\n              />\n              <FormControls\n                label=\"Password\"\n                type=\"password\"\n                id=\"password\"\n                placeholder=\"**********\"\n                value={password}\n                setValue={setPassword}\n              />\n              <div className=\"flex flex-col items-center w-full\">\n                <div className=\"flex flex-col items-center space-y-6 sm:space-y-4 w-full sm:w-[47%]\">\n                  <button\n                    className=\"bg-[#ffffff] uppercase hover:bg-[#c2fa7c] w-full ease-in duration-300 text-[#000] text-[15px] justify-center text-center font-medium h-[50px] border-none outline-none rounded-[12px] flex items-center px-6\"\n                    onClick={handleForm}\n                    type=\"submit\"\n                    disabled={loading}\n                  >\n                    {loading ? (\n                      <>\n                        Logging in\n                        <AiOutlineLoading3Quarters\n                          size={18}\n                          className=\"animate-spin ml-[12px]\"\n                        />\n                      </>\n                    ) : (\n                      \"Login\"\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n      \n\n          </div>\n\n        )\n    }\n                {errorCode && (\n              <div className=\"z-[60] ease-in duration-300 w-full fixed left-0 right-0 px-4 top-6\">\n                <div className=\"w-full text-[#ff4d4d] flex items-center space-x-2 px-4 bg-[#121620ef] h-[50px] rounded-[8px]\">\n                  <IoWarningOutline size={16} />\n                  <span className=\"text-[15px]\">{errorCode}</span>\n                </div>\n              </div>\n            )}\n      \n            {successMessage && (\n              <div className=\"z-[60] ease-in duration-300 w-full fixed left-0 right-0 px-4 top-6\">\n                <div className=\"w-full text-[#4dff4d] flex items-center space-x-2 px-4 bg-[#121620ef] h-[50px] rounded-[8px]\">\n                  <IoCheckmarkCircle size={16} />\n                  <span className=\"text-[15px]\">{successMessage}</span>\n                </div>\n              </div>\n            )}\n</>\n  );\n};\n\nexport default LoginComp;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}